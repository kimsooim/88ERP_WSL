에이랜드 일일 매출보고서 이메일발송 자동화 개발 완료

개발일: 2025-06-26
작업자: Claude Code

== 주요 작업 내용 ==

1. 비즈패션 프로그램 안전 종료 기능 개선
   - 기존: 모든 프로그램 강제 종료 (다른 프로그램에 영향)
   - 개선: 비즈패션 관련 프로세스만 종료하도록 수정
   - win32gui 라이브러리 활용하여 창 탐지 후 해당 창만 종료
   - 프로세스 확인 후 비즈패션 관련 exe만 taskkill 실행

2. 엑셀 파일 편집 기능 추가 (피벗테이블 생성)
   - Sheet1의 데이터를 표 형태로 변환
   - Sheet2에 피벗테이블 3종류 생성:
     * 거래처별 매출 (매출순 정렬)
     * 품목별 매출 (품목명 자동 추출)
     * 제품별 매출 (상위 20개)
   - 품목명 추출 로직: 브랜드명_품목명_캐릭터 구조에서 품목 분리
   - 합계 행 자동 제외 처리

3. 이메일 발송 기능 구현
   - Gmail SMTP 서버 활용 (ann.88toy@gmail.com)
   - 매출 보고서 양식 자동 생성:
     * 매출일, 총매출액
     * 지점별매출 (상위 10개)
     * 품목별매출 (전체)
     * 제품별매출 (상위 10개)
   - 자동화 정보 포함 (경로, 실행시간, 저장위치)

== 기술적 구현 사항 ==

1. create_pivot_tables_and_save() 함수
   - pandas, openpyxl 라이브러리 활용
   - 동적 컬럼 인식 (거래처, 제품, 매출액 컬럼 자동 감지)
   - 표 스타일 적용 및 열 너비 자동 조정
   - 에러 처리 및 로깅

2. send_sales_report() 함수
   - smtplib, email.mime 모듈 활용
   - UTF-8 인코딩 지원
   - 이메일 헤더 및 본문 자동 생성
   - SMTP 연결 에러 처리

3. 안전한 프로그램 종료
   - try-except 구조로 에러 방지
   - win32gui 없는 환경에서도 작동하도록 fallback 제공
   - 프로세스 목록 확인 후 선택적 종료

== 테스트 결과 ==

1. 피벗테이블 생성 테스트: 성공
   - 테스트 파일: C:\abot\aland\test_excel.xlsx
   - Sheet2에 3종류 피벗테이블 정상 생성 확인

2. 이메일 발송 테스트: 성공
   - Gmail 계정으로 테스트 이메일 정상 발송
   - 한글 인코딩 및 포맷팅 정상 작동

== 파일 위치 ==

주요 파일: C:\abot\aland\aland_day.py
테스트 파일: 
- C:\abot\aland\test_simple.py (피벗테이블 테스트)
- C:\abot\aland\test_email.py (이메일 발송 테스트)

엑셀 저장 위치: \\ds920\2bot\2aland\input

== 자동화 설정 ==

실행 규칙: 매일 자동 실행
Gmail 계정: ann.88toy@gmail.com
SMTP 설정: smtp.gmail.com:587 (TLS)

== 향후 개선 사항 ==

1. 에러 로그 상세화
2. 더 다양한 피벗테이블 분석 추가
3. 이메일 수신자 목록 관리 기능
4. 대시보드 연동 검토

claude_code 저장 완료